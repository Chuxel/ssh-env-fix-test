ARG IMAGE_TO_TEST="mcr.microsoft.com/vscode/devcontainers/base:0-focal"
FROM $IMAGE_TO_TEST

ENV PATH=/front-dockerfile-pre-script:$PATH:/back-dockerfile-pre-script
ENV this_var=true

ARG DEFAULT_SHELL_TYPE=bash
COPY *.sh library-scripts/*.sh /tmp/scripts/
RUN bash /tmp/scripts/sshd-debian.sh \
    && bash /tmp/scripts/test-prep.sh ${DEFAULT_SHELL_TYPE}

ENV that_var=true
ENV PATH=/front-dockerfile-post-script:$PATH:/back-dockerfile-post-script

ENTRYPOINT [ "/usr/local/share/ssh-init.sh" ]
CMD [ "sleep", "infinity" ]